# Functions - ~/Dropbox/Softwares/Linux/tmux/tmux_completion_bash.sh
# To show options:
#   tmux show-options -g [option_name]  : Show global option/show all if none specified
#   tmux show-options -w [option_name]  : Show window option/show all if none specified
#   tmux show-options -s [option_name]  : Show server option/show all if none specified

#=======================================================================================================================
# MAIN                                                                                                              {{{1
#=======================================================================================================================
# <C-B> is a pain to use when in copy mode as to scroll-up a full screen, we've to press <C-B> twice since upon the first
# press it's interpreted as a prefix. Thus change it to <C-Q>. <C-A> collides with emacs readline
unbind C-b
set -g prefix C-q
# For nested Tmux sessions
#bind C-q send-prefix

# Disable wait for escape sequence to enable faster command sequence
set -sg escape-time 0
set -sg repeat-time 600

# Mouse support
set -g mouse on

# Set bash as the default shell
#set -g default-shell /tool/pandora64/bin/bash

# VI mode for copy-paste
setw -g mode-keys vi

# Set the default terminal mode to 256color mode
set -g default-terminal "xterm-256color"

set -g history-limit 10000

# Sane scrolling (http://superuser.com/a/314620)
set -ga terminal-overrides ',xterm*:smcup@:rmcup@'

setw -g alternate-screen on


#=======================================================================================================================
# STATUS BAR                                                                                                        {{{1
#=======================================================================================================================
set -g status on
#set -g status-keys emacs

# Center the window list
#set -g status-justify centre

# Colors
set -g status-fg colour7
set -g status-bg colour18
#set -g status-left-fg white
#set -g status-left-bg colour25
set -g message-fg colour7
set -g message-bg colour0
set -g message-attr bright

# Increase the time between refresh (Default=15)
set -g status-interval 60

#set-option -g status-position top
set -g status-left-length 50
set -g status-left ' #[fg=colour1,bold]#S#[fg=colour7] #[fg=colour8]•'
set -g status-right-length 60
# Bug in bash causes jobs to send nothing to the pipe
set -g status-right "#[fg=colour8]•#[fg=colour4] JOBS: #(command jobs -r 2>/dev/null | wc -l)r #(command jobs -s 2> /dev/null | wc -l)s #[fg=colour8]•#[fg=colour4] LSF: #(command lsf_bjobs -sum | tail -n1 | command awk '{print $1\"r \"$5\"p\"}') #[fg=colour8]• #[fg=colour3]%b %d, %a %H:%M "

#set -g set-titles on
#set -g set-titles-string '#H #S'

# Enable activity alerts
setw -g monitor-activity on
set  -g visual-activity on



#=======================================================================================================================
# PANE                                                                                                              {{{1
#=======================================================================================================================
# Set the starting window index to 1
setw -g pane-base-index 1

# Make the active pane stand-out visually
set -g pane-border-fg        colour18
set -g pane-active-border-fg colour18




#=======================================================================================================================
# WINDOW                                                                                                            {{{1
#=======================================================================================================================
# Set the starting window index to 1
set -g base-index 1

# setw -g window-active-style 'bg=#272822'    # bg color of active pane
# setw -g window-style        'bg=#272822'    # bg color of inactive panes

# Status Bar display
setw -g window-status-format "#[fg=colour20] #I:#W "
setw -g window-status-attr bright
setw -g window-status-current-format "#[attr=bright]#[fg=colour5] #I:#W "
setw -g window-status-current-attr bright

# Activity display
setw -g window-status-activity-attr blink

# Window is only constrained in size if a smaller client is actively looking at it
setw -g aggressive-resize on



#=======================================================================================================================
# BINDINGS                                                                                                          {{{1
#=======================================================================================================================
# -r : Indicates that the binding is repeatable i.e. the prefix need not be pressed again to use it

#-----------------------------------------------------------------------------------------------------------------------
# Misc Bindings                                                                                                     {{{2
#
# Reload tmux.conf
unbind r
bind r   source-file ~/.tmux.conf \; refresh-client -S\; display-message " Config reloaded".
unbind C-r
bind C-r source-file ~/.tmux.conf \; refresh-client -S\; display-message " Config reloaded".

# Remove suspend-client binding
unbind C-z

# bind ? split-window -h -l 80 \; list-keys

# Allows fast scrolling through a pane's history. -e specifies that scrolling to the bottom exits copy-mode
bind PageUp copy-mode -eu

# copy-paste
# I'm using 'C-Space' as my insert-mode leader in vim
unbind -T copy-mode 'C-Space'

bind -T copy-mode-vi 'v'   send -X begin-selection
bind -T copy-mode-vi 'V'   send -X select-line
bind -T copy-mode-vi 'C-v' send -X rectangle-toggle
bind -T copy-mode-vi 'y'   send -X copy-selection-and-cancel
bind -T copy-mode-vi 'Y'   send -X copy-pipe-and-cancel
# Use prefix+] to paste. prefix+p would be the logical choice for paste but it's better used in next/previous context

#-----------------------------------------------------------------------------------------------------------------------
# Pane Bindings                                                                                                     {{{2
#

#bind -r C-n select-pane -t :.+
#bind -r C-p select-pane -t :.-
unbind C-Space
bind -r C-q last-pane

unbind Up
unbind Down
unbind Left
unbind Right

bind C-h select-pane -L
bind C-j select-pane -D
bind C-k select-pane -U
bind C-l select-pane -R

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Kill pane without confirmation
bind    c   kill-pane
bind    C-o kill-pane -a

# Create Panes
bind -r C-s split-window -v -c '#{pane_current_path}'
bind -r C-v split-window -h -c '#{pane_current_path}'

# Move pane to new Window
#bind    C-b break-pane
# Move existing window to pane
#bind    C-f command-prompt -p "Join pane from:"  "join-pane -s ':%%'"

# Swap panes
#bind -r { swap-pane -U
#bind -r } swap-pane -D

# Goto Pane
bind C-g display-panes

# Resize Panes
bind -r S-Up    resize-pane -U 20
bind -r S-Down  resize-pane -D 20
bind -r S-Left  resize-pane -L 20
bind -r S-Right resize-pane -R 20


#-----------------------------------------------------------------------------------------------------------------------
# Window Bindings                                                                                                   {{{2
#
bind -r M-C-h previous-window
bind -r M-C-l next-window
bind -r M-C-q last-window

bind -r M-C-n new-window

# Kill window without confirmation
bind    M-C-c kill-window
# Kill other windows
bind    M-C-o kill-window -a

# Move window left
bind -r M-{ swap-window -t -1
bind -r M-} swap-window -t +1

#bind M-C-j command-prompt -p "Join pane to:"  "join-pane -t ':%%'"

#bind M-C-g command-prompt -p "Goto Window:" "select-window -t '%%'"
